---
title: KubernetesåŸºç¡€å®éªŒ
weight: 3
---
# KubernetesåŸºç¡€å®éªŒ

## å®éªŒç›®çš„

- äº†è§£Kubernetesçš„å„ç§ç‰¹æ€§
- ç†Ÿæ‚‰Kubernetesçš„åŸºç¡€ä½¿ç”¨

## èƒŒæ™¯

ä¸Šæ¬¡å®éªŒä¸­ï¼Œæˆ‘ä»¬ä¸»è¦äº†è§£äº†ä»€ä¹ˆæ˜¯å®¹å™¨ï¼Œä»¥åŠç›®å‰æœ€æµè¡Œçš„å®¹å™¨è¿è¡Œæ—¶å’Œå®¹å™¨ç®¡ç†å·¥å…·Dockerï¼›å¹¶ä¸”åœ¨æ­¤è¿‡ç¨‹ä¸­ä½“ä¼šäº†å®¹å™¨æŠ€æœ¯ç»™è½¯ä»¶å¼€å‘å’Œéƒ¨ç½²å¸¦æ¥çš„æå¤§çš„ä¾¿åˆ©æ€§ã€‚

ä½†åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯¹å®¹å™¨çš„ä½¿ç”¨å’Œç®¡ç†ä¾æ—§å¤„äºéå¸¸â€œæ‰‹å·¥â€çš„çŠ¶æ€ï¼Œéš¾ä»¥èƒœä»»å®é™…ç”Ÿäº§ç¯å¢ƒä¸­å¯¹å®¹å™¨ç®¡ç†çš„è¦æ±‚ã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œ

1. é€šå¸¸ä¸€ä¸ªåº”ç”¨åŒ…å«å¤šä¸ªå®¹å™¨ï¼›å³ï¼Œä¸€ä¸ªåº”ç”¨çš„éƒ¨ç½²ï¼Œéœ€è¦æŒ‰ç…§ä¸€å®šçš„é¡ºåºå¯åŠ¨å¤šä¸ªå®¹å™¨ã€‚ä¾‹å¦‚ï¼Œå³ä¾¿æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„å‰åç«¯åº”ç”¨ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦**ä¾æ¬¡**å¯åŠ¨ä¸‰ä¸ªå®¹å™¨ï¼šæ•°æ®åº“å®¹å™¨ï¼ˆä¾‹å¦‚ä¸€ä¸ªMySQLå®¹å™¨ï¼‰ã€åç«¯åº”ç”¨å®¹å™¨ã€å‰ç«¯åº”ç”¨å®¹å™¨ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªNginxå®¹å™¨ï¼‰ã€‚ç‰¹åˆ«æ˜¯åœ¨å¾®æœåŠ¡åœºæ™¯ä¸­ï¼Œåç«¯å¯èƒ½æ¶‰åŠåˆ°å‡ åä¸ªå¾®æœåŠ¡æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—éƒ½å¯¹åº”ç€ä¸€ä¸ªå®¹å™¨ï¼Œä¸åŒæœåŠ¡ä¹‹é—´åˆæœ‰å¤æ‚çš„ä¾èµ–è°ƒç”¨å…³ç³»ã€‚
2. æ¯ä¸ªç±»åˆ«çš„æœåŠ¡é€šå¸¸ä¼šæœ‰å¤šä¸ªå®¹å™¨å®ä¾‹ã€‚å¯¹äºä¸€äº›è´Ÿè½½è¾ƒé«˜çš„æœåŠ¡ï¼Œé€šå¸¸ä¼šéƒ¨ç½²å¤šä¸ªç›¸åŒçš„å®¹å™¨å®ä¾‹è¾¾åˆ°è´Ÿè½½å‡è¡¡çš„æ•ˆæœï¼Œä»è€Œæé«˜æœåŠ¡æ•´ä½“çš„ååé‡ã€‚
3. å®¹å™¨æ˜¯ä¸ç¨³å®šçš„ï¼Œéšæ—¶å¯èƒ½ä¼šå› ä¸ºå„ç§å„æ ·çš„åŸå› æŒ‚æ‰ï¼Œå› æ­¤ï¼Œéœ€è¦æ—¶åˆ»ç›‘æ§å®¹å™¨çš„çŠ¶æ€ï¼Œåœ¨å®ƒæŒ‚æ‰çš„æ—¶å€™åŠæ—¶é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œä¿è¯æœåŠ¡æ•´ä½“çš„é«˜å¯ç”¨ã€‚
4. å¤§éƒ¨åˆ†åº”ç”¨éƒ½æ˜¯åˆ†å¸ƒå¼çš„ã€‚å³ï¼Œä¸€ä¸ªåº”ç”¨ä¸­çš„ä¸åŒæœåŠ¡æ˜¯éƒ¨ç½²åœ¨ä¸åŒæœºå™¨ä¸Šçš„ï¼Œå³ä½¿æ˜¯ä¸€ä¸ªæœåŠ¡çš„ä¸åŒå®ä¾‹å¾€å¾€ä¹Ÿä¼šéƒ¨ç½²åœ¨å¤šä¸ªæœºå™¨ä¸Šã€‚å¦‚ä½•åœ¨å¤šå°æœºå™¨ä¸Šåšå¥½èµ„æºï¼ˆå†…å­˜ã€CPUã€ç£ç›˜ï¼‰çš„è´Ÿè½½å‡è¡¡ï¼ˆå³ï¼Œé¿å…å‡ºç°æŸäº›æœºå™¨è´Ÿè½½è¿‡é«˜çš„åŒæ—¶ï¼Œå…¶ä»–æœºå™¨è´Ÿè½½ç©ºé—²çš„æƒ…å†µï¼‰ä¹Ÿæ˜¯æ£˜æ‰‹çš„é—®é¢˜ã€‚

å¦‚æœä»…é æˆ‘ä»¬å·²ç»å­¦åˆ°çš„å‡ ä¸ªdockerå‘½ä»¤æ˜¾ç„¶æ˜¯éš¾ä»¥å®Œæˆä¸Šè¿°ä»»åŠ¡çš„ã€‚è¿™å°±éœ€è¦ä¸€ä¸ªä¸“é—¨çš„å®¹å™¨ç¼–æ’è°ƒåº¦å·¥å…·å¸®æˆ‘ä»¬å¤„ç†è¿™äº›äº‹æƒ…ã€‚è‡ªDockerå…´èµ·åï¼Œå¾ˆå¤šå‚å•†éƒ½è¿›å…¥è¯¥é¢†åŸŸå¹¶æ¨å‡ºäº†è‡ªå·±çš„å®¹å™¨ç¼–æ’è°ƒåº¦è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚Docker Swarmã€Mesosç­‰ï¼Œéƒ½æƒ³åœ¨æ–°å…´çš„å®¹å™¨å¸‚åœºä¸­åˆ†ä¸€æ¯ç¾¹ï¼Œä½†æœ€ç»ˆKubernetesç¬‘åˆ°äº†æœ€åï¼Œå¹¶ä¸”ä½œä¸ºCNCFçš„æ¯•ä¸šé¡¹ç›®ï¼Œæˆä¸ºäº†å½“ä¸‹å®¹å™¨ç¼–æ’è°ƒåº¦é¢†åŸŸçš„äº‹å®æ ‡å‡†ã€‚æœ¬æ¬¡å®éªŒæˆ‘ä»¬å°±æ¥è®¤è¯†ä¸€ä¸‹Kubernetesï¼Œå­¦ä¹ å¹¶å®è·µå…¶ä¸­ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚

![](download/VI8sKsx.jpg)

Kubernetesä»¥å…¶å¤æ‚éš¾æ‡‚è‘—ç§°ï¼Œåœ¨æœ¬æ¬¡å®éªŒä¸­ï¼Œæˆ‘ä»¬ä¸»è¦å­¦ä¹ å…¶ä¸­æœ€åŸºæœ¬çš„éƒ¨åˆ†ï¼ŒåŸ¹å…»å¤§å®¶å¯¹Kubernetesçš„æ„Ÿæ€§è®¤è¯†ï¼Œå¸®åŠ©å¤§å®¶å¼€å§‹å…¥é—¨äº‘è®¡ç®—é¢†åŸŸã€‚

![](download/HtGSlKi.png)

## åˆè¯†Kubernetes

### Kubernetesç®€ä»‹

Kubernetesåœ¨å¸Œè…Šè¯­ä¸­çš„å«ä¹‰æ˜¯èˆ¹é•¿/é¢†èˆªå‘˜ï¼Œè¿™ä¸ªåå­—ç”ŸåŠ¨åœ°ä½“ç°äº†å®ƒåœ¨å®¹å™¨é›†ç¾¤ç®¡ç†ä¸­çš„ä½œç”¨â€”â€”è°ƒåº¦å’Œç›‘æ§å…¨å±€çš„é›†è£…ç®±ï¼ˆcontainerï¼Œå®¹å™¨ï¼‰ã€‚ç”±äºKubernetesè¿™ä¸ªå•è¯å¤ªé•¿ï¼Œäººä»¬é€šå¸¸ä¼šç”¨k8sæ¥ä½œä¸ºç®€ç§°ï¼ˆKubernetesçš„é¦–å°¾ä¸¤ä¸ªå­—æ¯ä¹‹é—´æ­£å¥½æœ‰8ä¸ªå­—æ¯ï¼‰ã€‚

è¯·å§‹ç»ˆè®°ä½ï¼ŒKuberneteså’ŒDockerä¹‹ç±»çš„å®¹å™¨è¿è¡Œæ—¶ä¸æ˜¯äº’ç›¸æ›¿ä»£çš„å…³ç³»ï¼Œä¹Ÿä¸æ˜¯åŒ…å«ä¸è¢«åŒ…å«çš„å…³ç³»ï¼Œè€Œæ˜¯äº’è¡¥çš„å…³ç³»ã€‚Kubernetesä»…ä»…æ˜¯ä¸€ä¸ªå®¹å™¨ç¼–æ’å’Œè°ƒåº¦å·¥å…·ï¼Œå…¶å¿…é¡»è¿è¡Œåœ¨â€œå®¹å™¨è¿è¡Œæ—¶ï¼ˆcontainer runtimeï¼‰â€ä¹‹ä¸Šã€‚å®ƒèƒ½åšçš„ä»…ä»…æ˜¯æ¥æ”¶ç”¨æˆ·çš„å‘½ä»¤ï¼Œç„¶åé€šçŸ¥å…¶ä¸‹å±‚çš„å®¹å™¨è¿è¡Œæ—¶åšå…·ä½“çš„å·¥ä½œã€‚

![](download/iShot_2023-04-10_16.17.54.png)

ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œåœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥é€šè¿‡Dockerå‘½ä»¤è¡Œæˆ–Docker HTTPæ¥å£æ¥ä¸Dockerå®¹å™¨è¿è¡Œæ—¶é€šä¿¡ï¼Œæ§åˆ¶å…¶æ„å»ºé•œåƒã€æ¨é€æˆ–æ‹‰å–é•œåƒã€å¯åŠ¨æˆ–åœæ­¢å®¹å™¨ï¼Œç­‰ç­‰ã€‚

è€Œç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Kubernetesçš„å‘½ä»¤è¡Œå·¥å…·ï¼ˆå³Kubectlï¼‰æˆ–Kubernetesçš„HTTPæ¥å£æ¥æ§åˆ¶Kubernetesï¼Œç„¶åï¼ŒKubernetesä¼šæ ¹æ®æˆ‘ä»¬å‘å‡ºçš„å‘½ä»¤ï¼Œâ€œç¿»è¯‘â€æˆå¯¹åº”çš„Dockerå®¹å™¨è¿è¡Œæ—¶çš„è°ƒç”¨ï¼Œä»è€Œæ§åˆ¶Dockerå®¹å™¨è¿è¡Œæ—¶æ„å»ºé•œåƒã€æ¨é€æˆ–æ‹‰å–é•œåƒã€å¯åŠ¨æˆ–åœæ­¢å®¹å™¨ç­‰ç­‰ã€‚

å¦å¤–ï¼Œè¯·æ³¨æ„ï¼ŒKubernetesæ˜¯ä¸€ä¸ªéå¸¸æ¨¡å—åŒ–çš„ç³»ç»Ÿï¼Œå®ƒå®šä¹‰äº†ä¸€å¥—â€œå®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆCRIï¼‰â€ï¼Œå‡¡æ˜¯å®ç°äº†è¿™å¥—æ¥å£çš„å®¹å™¨è¿è¡Œæ—¶éƒ½å¯ä»¥ä½œä¸ºKubernetesè¿è¡Œå®¹å™¨çš„åç«¯ã€‚ç›®å‰æ¯”è¾ƒæµè¡Œçš„æœ‰Containerdå’ŒCRI-Oï¼Œå®é™…ä¸Šï¼Œä»1.20ç‰ˆæœ¬å¼€å§‹ï¼ŒKuberneteså®˜æ–¹å·²ç»å¼ƒç”¨Dockerå¼•æ“ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ã€‚

![](download/KBTozW2.png)

> æ‰€è°“â€œKuberneteså®˜æ–¹å·²ç»ä¸å†æ”¯æŒä½¿ç”¨Dockerä½œä¸ºå®¹å™¨è¿è¡Œæ—¶â€ï¼Œå…¶å®æŒ‡çš„æ˜¯Kuberneteså®˜æ–¹ä¸å†ç»´æŠ¤Dockerçš„CRIå±‚ã€‚ä½†ç”±äºå†å²æƒ¯æ€§ç­‰åŸå› ï¼Œå¾ˆå¤šKubernetesçš„ä¸‹æ¸¸å‘è¡Œç‰ˆéƒ½ä¼šé€‰æ‹©ç»§ç»­æä¾›å¯¹Dockerçš„æ”¯æŒï¼ˆå½“ç„¶ï¼Œè¿™å¾—ç›ŠäºKubernetesæœ¬èº«ä¸å®¹å™¨è¿è¡Œæ—¶çš„è§£è€¦ï¼‰ã€‚
> åœ¨æœ¬æ¬¡å®éªŒä¸­ï¼Œä¸ºäº†å‰åçŸ¥è¯†çš„è¿è´¯æ€§ï¼Œæˆ‘ä»¬ä¾æ—§é€‰æ‹©ä½¿ç”¨Dockerä½œä¸ºKubernetesçš„å®¹å™¨è¿è¡Œæ—¶ã€‚

### åˆ›å»ºKubernetesé›†ç¾¤

åœ¨Kuberneteså®˜ç½‘çš„[Get Started](https://kubernetes.io/docs/setup/)ä¸­ï¼Œåˆ†åˆ«ç»™å‡ºäº†é¢å‘ä¸ªäººåˆå­¦è€…çš„å­¦ä¹ æµ‹è¯•ç¯å¢ƒå’Œä¸€çº¿ç”Ÿäº§ç¯å¢ƒçš„è‹¥å¹²Kubernetesé›†ç¾¤éƒ¨ç½²æ–¹æ³•ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œ[Kuberneteså®˜æ–¹æ¨èä½¿ç”¨ `kubeadm`æ¥å¯åŠ¨é›†ç¾¤](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/)ã€‚ä½†å®é™…ä¸Šï¼Œ`kubeadm`å¯¹éä¸“ä¸šçš„è¿ç»´ï¼Œç‰¹åˆ«æ˜¯åˆå­¦è€…æ¥è¯´å¹¶ä¸ååˆ†å‹å¥½ï¼ˆéœ€è¦ç”¨æˆ·äº‹å…ˆå®Œæˆå¯¹ä¸»æœºçš„ä¸€ç³»åˆ—é…ç½®ï¼Œå¦‚å¼€æ”¾é˜²ç«å¢™ç«¯å£ã€å…³é—­swapã€å®‰è£…å®¹å™¨è¿è¡Œæ—¶ç­‰ï¼‰ï¼Œå†åŠ ä¸Šå›½å†…ç‰¹æ®Šçš„ç½‘ç»œç¯å¢ƒï¼Œå› æ­¤ä¸æ¨èåˆå­¦è€…ç›´æ¥ä½¿ç”¨ `kubeadm`å¯åŠ¨é›†ç¾¤ã€‚

![](download/Cr1awaZ.png)

äº‘è®¡ç®—ç”Ÿæ€éå¸¸ç¹è£ï¼Œç¤¾åŒºä¸­å·²ç»æœ‰å¾ˆå¤šæˆç†Ÿçš„å·¥å…·å¸®åŠ©ç”¨æˆ·å¿«é€Ÿå¯åŠ¨ä¸€ä¸ªæ ‡å‡†çš„Kubernetesé›†ç¾¤ç”¨äºå­¦ä¹ ã€æµ‹è¯•ç­‰ç›®çš„ã€‚æœ¬å®éªŒæ–‡æ¡£åˆ†åˆ«é’ˆå¯¹é›†ç¾¤ç‰ˆå’Œæœ¬åœ°ç‰ˆæä¾›åˆ›å»ºKubernetesé›†ç¾¤çš„é€‰é¡¹ï¼Œä¾›å¤§å®¶å‚è€ƒå’Œä½¿ç”¨ã€‚

#### é›†ç¾¤ç‰ˆ

**æ¨èä½¿ç”¨æ­¤ç§æ–¹å¼åˆ›å»ºé›†ç¾¤**ï¼Œè¿™æ ·æœ‰åˆ©äºåœ¨åç»­ç« èŠ‚ä¸­å­¦ä¹ å’Œå®è·µKubernetesâ€œé›†ç¾¤â€çš„ç›¸å…³ç‰¹æ€§ã€‚å¦‚ç¡®å®æœ‰é—®é¢˜ï¼Œå¯ä»¥åˆ‡æ¢åˆ°ä¸ªäººç”µè„‘ä¸Šä½¿ç”¨â€œå•æœºç‰ˆâ€çš„æ–¹å¼ã€‚

åœ¨æœ¬æ¬¡å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†éƒ¨ç½²ä¸€ä¸ªç®€å•çš„[k3s](https://k3s.io)ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯â€œk8sâ€å“¦ï¼ï¼‰é›†ç¾¤ã€‚k3sæ˜¯é€šè¿‡CNCFè®¤è¯çš„Kubernetesçš„ä¸€ä¸ªå‘è¡Œç‰ˆï¼Œæ˜¯åŸºäºä¸Šæ¸¸çš„â€œåŸç”Ÿâ€çš„Kubernetesçš„ä»£ç è¿›ä¸€æ­¥æ„å»ºçš„ã€‚k3så’ŒKubernetesçš„å…³ç³»å¯ä»¥ç®€å•ç±»æ¯”ä¸ºUbuntuã€CentOSç­‰äºLinuxä¹‹é—´çš„å…³ç³»ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°k3så®˜æ–¹ç»´æŠ¤çš„[k3sçš„ä¸­æ–‡æ–‡æ¡£](https://docs.rancher.cn/k3s/)ã€‚

> å®é™…ä¸Šï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„Kuberneteså‘è¡Œç‰ˆï¼Œæ¯”å¦‚k0sä¹‹ç±»çš„ã€‚åªä¸è¿‡k3sçš„ä¸­å›½åŒ–åšå¾—éå¸¸å¥½ï¼Œåœ¨å›½å†…çš„ç½‘ç»œç¯å¢ƒä¸‹ä½¿ç”¨éå¸¸ä¾¿åˆ©ï¼Œä¹Ÿæœ‰å¤§é‡çš„èµ„æ–™å¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰ç”¨å…¶ä½œä¸ºæœ¬æ¬¡å®éªŒçš„ä¸»è¦å·¥å…·ã€‚å½“ç„¶ï¼Œä¸åŒKuberneteså‘è¡Œç‰ˆä¹‹é—´å­˜åœ¨ç€å„ç§å„æ ·çš„å·®å¼‚ï¼Œä½†è¿™å¹¶ä¸å½±å“æˆ‘ä»¬å­¦ä¹ Kubernetesçš„åŸºç¡€çŸ¥è¯†ã€‚

1. å‡†å¤‡ä¸€å°èƒ½å¤Ÿè¿æ¥äº’è”ç½‘çš„Linuxæœºå™¨ã€‚å¦‚æœä½ é€‰æ‹©ä½¿ç”¨è½¯é™¢äº‘å¹³å°åˆ†é…çš„æœºå™¨ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œä¸‹ä¸€æ­¥ï¼›å¦åˆ™ï¼Œè¯·æŸ¥çœ‹[å®‰è£…è¦æ±‚](https://docs.rancher.cn/docs/k3s/installation/installation-requirements/_index/)ï¼Œç¡®ä¿ä½ çš„æœºå™¨æ»¡è¶³å…¶ä¸­æ‰€è¿°æ¡ä»¶ã€‚
2. ä¿è¯ä½ çš„æœºå™¨å·²ç»è¿æ¥äº’è”ç½‘ã€‚
3. **åˆ‡æ¢åˆ°rootç”¨æˆ·**ï¼ˆå¦‚æœä½ è§‰å¾—rootæ“ä½œå±é™©ï¼Œè¯·ä¿è¯è‡ªå·±æœ‰è¶³å¤Ÿçš„èƒ½åŠ›ä½¿ç”¨æ™®é€šç”¨æˆ·æƒé™å®Œæˆæ‰€æœ‰æ“ä½œï¼‰

   ```shell
   sudo -i
   ```
4. å®‰è£… Docker

   ```shell
   curl -fsSL https://get.docker.com/ -o get-docker.sh && sh get-docker.sh --mirror Aliyun
   ```
5. ç¡®ä¿æœºå™¨å·²ç»å®‰è£…Dockerï¼Œå¹¶ä¸”å…¶ç‰ˆæœ¬é«˜äºæˆ–ç­‰äº `19.03`ï¼Œå¯ä»¥ä½¿ç”¨ `docker info` å‘½ä»¤éªŒè¯ï¼Œè¯·æ³¨æ„æ˜¯å¦æ­£ç¡®é…ç½® Docker Registry é•œåƒåœ°å€ï¼Œä»¥ä¿è¯å¯ä»¥é¡ºåˆ©ä» `docker.io` ä¸­æ‹‰å–é•œåƒã€‚ï¼ˆå½“ç„¶ï¼Œå¦‚æœä½ å·²ç»æ¯”è¾ƒç†Ÿæ‚‰ Kubernetesï¼Œå¯ä»¥å¿½ç•¥æ­¤æ­¥éª¤ï¼Œé€‰æ‹©ä½¿ç”¨ k3s é»˜è®¤é›†æˆå®‰è£…çš„ containerd ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ã€‚ï¼‰
6. æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥åˆå§‹åŒ–ä¸€ä¸ªk3sçš„masterèŠ‚ç‚¹ï¼ˆå½“å‰ä¸ç†è§£ä»€ä¹ˆæ˜¯â€œmasterèŠ‚ç‚¹â€æ²¡æœ‰å…³ç³»ï¼Œåœ¨åç»­ç« èŠ‚ä¸­æˆ‘ä»¬ä¼šè¿›è¡Œè¯¦ç»†ä»‹ç»ï¼‰ï¼š

   ```shell
   curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn sh -s - --docker
   ```

   å¦‚æœä½ é€‰æ‹©ä½¿ç”¨containerdä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼Œè¯·å»é™¤ä¸Šè¿°å‘½ä»¤ä¸­çš„ `--docker`å‚æ•°ã€‚
7. ç­‰å¾…ä¸Šè¿°å‘½ä»¤æ‰§è¡Œç»“æŸåï¼Œå®é™…ä¸Šæˆ‘ä»¬çš„k3så·²ç»å®‰è£…å®Œæˆï¼Œå³ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†ä¸€ä¸ªå¯ç”¨çš„Kubernetesé›†ç¾¤ã€‚åœ¨ç»§ç»­åç»­æ“ä½œå‰ï¼Œæˆ‘ä»¬å…ˆå®Œå–„ä¸€ä¸‹é…ç½®ï¼š

   ```shell
   echo 'export KUBECONFIG=/etc/rancher/k3s/k3s.yaml' >> ~/.bashrc
   source ~/.bashrc
   ```

   æ³¨æ„ï¼Œå¦‚æœä½ ä½¿ç”¨çš„ä¸æ˜¯bashï¼Œè¯·æ³¨æ„æ›´æ”¹ä¸Šè¿°å‘½ä»¤ã€‚
8. ä½¿ç”¨ `kubectl get node`éªŒè¯ä¸€ä¸‹Kubernetesé›†ç¾¤æ˜¯å¦å°±ç»ªï¼Œä¸€èˆ¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š

   ```txt
   NAME     STATUS   ROLES                  AGE    VERSION
   debian   Ready    control-plane,master   2d1h   v1.24.4+k3s1
   ```

   `kubectl get node`è¿™æ¡å‘½ä»¤æ˜¯è‡ªè§£é‡Šçš„ï¼Œå«ä¹‰æ˜¯ï¼Œè·å–å½“å‰Kubernetesé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰æˆ‘ä»¬è¿™ä¸ªKubernetesé›†ç¾¤ä¸­ï¼Œä»…æœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”ï¼š

   - å…¶åå­—ï¼ˆ`NAME`ï¼‰æ˜¯ `debian`ï¼ˆè¿™ä¸ªåå­—ä¸€èˆ¬æ˜¯å½“å‰æœºå™¨çš„hostnameï¼‰ï¼›
   - å…¶çŠ¶æ€ï¼ˆ`STATUS`ï¼‰æ˜¯ `Ready`ï¼ˆ`Ready`è¡¨ç¤ºèŠ‚ç‚¹çŠ¶æ€å¥åº·ï¼Œå¦‚æœä½ åˆšåˆšå®Œæˆé›†ç¾¤åˆ›å»ºï¼Œè¿™é‡Œçš„çŠ¶æ€æ˜¾ç¤ºå¯èƒ½æ˜¯ `Not Ready`ï¼Œä¸è¦ç€æ€¥ï¼Œç­‰ä¸€ä¼šå„¿å†çœ‹çœ‹ï¼‰ï¼›
   - å…¶åœ¨Kubernetesé›†ç¾¤ä¸­çš„è§’è‰²ï¼ˆ`ROLES`ï¼‰æ˜¯ `control-plane,master`ï¼Œå³ä¸¤ä¸ªè§’è‰²ï¼šæ§åˆ¶é¢ï¼ˆ`control-plane`ï¼‰ã€masterï¼›
   - å…¶åŠ å…¥å½“å‰Kubernetesé›†ç¾¤çš„æ—¶é—´ï¼ˆ`AGE`ï¼‰æ˜¯2å¤©1å°æ—¶ï¼ˆ`2d1h`ï¼‰å‰ï¼›
   - å…¶å½“å‰è¿è¡Œçš„Kubernetesç‰ˆæœ¬å·ï¼ˆ`VERSION`ï¼‰æ˜¯ `v1.24.4+k3s1`ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†ä¸€ä¸ªå¯ç”¨çš„Kubernetesé›†ç¾¤ã€‚ä½†æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œå½“å‰è¯¥é›†ç¾¤ä¸­ï¼Œä»…åŒ…å«ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¯¥èŠ‚ç‚¹çš„è§’è‰²ä¸º `control-plane,master`ã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¾ˆå°‘ä¼šæœ‰è¿™æ ·çš„åœºæ™¯ï¼Œä½†è¿™å¯¹æˆ‘ä»¬å®Œæˆä¸€äº›åŸºç¡€çš„å­¦ä¹ å’Œå®è·µä»»åŠ¡æ˜¯å®Œå…¨è¶³å¤Ÿçš„ã€‚å¦‚æœä½ æƒ³æ‹“å±•è‡ªå·±çš„è¿™ä¸ªå•èŠ‚ç‚¹é›†ç¾¤ä¸ºçœŸæ­£çš„ç”Ÿäº§å¯ç”¨çš„å¤šèŠ‚ç‚¹é›†ç¾¤ï¼ˆå¯ä»¥å’Œå…¶ä»–åŒå­¦åˆä½œå®Œæˆï¼Œä¾‹å¦‚3ä½åŒå­¦ä¸€èµ·ç»„ä»¶ä¸€ä¸ªç”±3ä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤ã€‚å½“ç„¶ï¼Œè¿™ä¸æ˜¯æœ¬æ¬¡å®éªŒçš„å¼ºåˆ¶è¦æ±‚ï¼‰ï¼Œå¯ä»¥å‚è€ƒ[k3sçš„æ–‡æ¡£](https://docs.rancher.cn/docs/k3s/installation/ha-embedded/_index)ã€‚

#### æœ¬åœ°ç‰ˆ

Kubernetesé›†ç¾¤ä»ä¸€å¼€å§‹å°±æ˜¯ä¸ºå¤§è§„æ¨¡çš„ç”Ÿäº§ç¯å¢ƒå‡†å¤‡çš„ï¼ˆå…¶æœ€æ—©å°±èµ·æºäºGoogleå†…éƒ¨çš„Borgï¼‰ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬æ¨èåœ¨æœ¬å®éªŒä¸­ä½¿ç”¨é›†ç¾¤ç‰ˆçš„æ–¹æ³•åˆ›å»ºé›†ç¾¤ã€‚

ä½†å®é™…ä¸Šåœ¨å¾ˆå¤šåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸å…³å¿ƒKubernetesçš„å¤šèŠ‚ç‚¹ç‰¹æ€§ï¼Œè€Œæ›´å…³å¿ƒå¦‚ä½•å¿«é€Ÿåœ¨æœ¬åœ°æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ªKubernetesé›†ç¾¤ç”¨äºç®€å•çš„å­¦ä¹ å’Œæµ‹è¯•ç›®çš„ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨[minikube](https://minikube.sigs.k8s.io/docs/)ä»‹ç»å¦‚ä½•åœ¨ä½  **æœ¬åœ°çš„ç”µè„‘ï¼ˆWindowsæˆ–macOSï¼‰** ä¸­å¯åŠ¨ä¸€ä¸ªç®€å•çš„Kubernetesé›†ç¾¤ã€‚

> ä»åå­—ä¸Šå¯ä»¥çœ‹å‡ºminikubeè¡¨ç¤ºâ€œmini kubernetesâ€ã€‚

> éœ€è¦æå‰è¯´æ˜çš„æ˜¯ï¼Œminikubeæœ¬è´¨ä¸Šæ˜¯åœ¨ä½ çš„Windowsæˆ–macOSä¸Šå¯åŠ¨äº†ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œå¹¶åœ¨è¿™ä¸ªè™šæ‹Ÿæœºä¸­é…ç½®äº†Kubernetesçš„ç›¸å…³ç»„ä»¶ã€‚å› æ­¤ï¼Œminikubeç”¨èµ·æ¥ä¸ä¼šå’Œk3sé‚£æ ·â€œç›´æ¥â€ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ï¼Œè¯·åŠæ—¶æŸ¥é˜…[å…¶æ–‡æ¡£](https://minikube.sigs.k8s.io/docs/)ã€‚

æœ¬èŠ‚å†…å®¹åªèƒ½ä¿è¯ä½ èƒ½æˆåŠŸå¯åŠ¨ä¸€ä¸ªminikubeå®ä¾‹ï¼Œå¦‚æœä½ éœ€è¦è¿›ä¸€æ­¥çš„ä¸ªæ€§åŒ–é…ç½®ï¼Œè¯·å‚è€ƒ[å®‰è£…æ–‡æ¡£](https://minikube.sigs.k8s.io/docs/start/)ã€‚

ç†è®ºä¸Šï¼Œminkubeçš„å®‰è£…éå¸¸ç®€å•ï¼ŒæŒ‰ç…§å…¶å®˜æ–¹æ–‡æ¡£çš„ä»‹ç»è¿›è¡Œå³å¯ã€‚ä½†ç”±äºä¼—æ‰€å‘¨çŸ¥çš„ç½‘ç»œé—®é¢˜ï¼Œæˆ‘ä»¬è¿™é‡Œå¯¹å®˜æ–¹æ–‡æ¡£çš„æ­¥éª¤è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ã€‚

1. ç¡®ä¿å·²ç»å®‰è£…Dockerï¼Œå¹¶ä¸”è‡ªå·±çš„è®¡ç®—æœºå·²ç»è”ç½‘ã€‚
2. å®‰è£…minikubeäºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¯·è¿›å…¥[è¿™ä¸ªåœ°å€](https://minikube.sigs.k8s.io/docs/start/)ï¼Œè¿›å…¥â€œInstallationâ€ä¸€èŠ‚ï¼Œé€‰æ‹©è‡ªå·±åˆé€‚çš„é€‰å‹ï¼ŒæŒ‰ç…§æç¤ºï¼Œè¿›è¡Œä¸‹è½½å’Œå®‰è£…ã€‚å®Œæˆè¯¥æ­¥éª¤åï¼Œæ— éœ€è¿›è¡Œè¯¥ç½‘é¡µä¸­çš„åç»­æ­¥éª¤ï¼Œè¯·å›åˆ°æœ¬æ–‡æ¡£ã€‚
   ![](download/qiMEbTT.png)
3. ä½¿ç”¨minikubeå¯åŠ¨ä¸€ä¸ªKubernetesé›†ç¾¤ï¼ˆæ³¨æ„æ ¹æ®è‡ªå·±ç”µè„‘é…ç½®çš„å®é™…æƒ…å†µè°ƒæ•´å‘½ä»¤ä¸­ `--cpus`å’Œ `--memory`çš„å€¼ï¼‰ï¼š

   ```shell
   minikube start --driver=docker --cpus=4 --memory=4096mb --registry-mirror=https://mirror.baidubce.com --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers
   ```

   ç„¶åï¼Œä½ å¤§æ¦‚ä¼šå¾—åˆ°å¦‚ä¸‹çš„è¾“å‡ºï¼š

   ```txt
   ğŸ˜„  Darwin 13.0 ä¸Šçš„ minikube v1.26.1
   âœ¨  æ ¹æ®ç”¨æˆ·é…ç½®ä½¿ç”¨ docker é©±åŠ¨ç¨‹åº
   âœ…  æ­£åœ¨ä½¿ç”¨é•œåƒå­˜å‚¨åº“ registry.cn-hangzhou.aliyuncs.com/google_containers
   ğŸ“Œ  Using Docker Desktop driver with root privileges
   ğŸ‘  Starting control plane node minikube in cluster minikube
   ğŸšœ  Pulling base image ...
   ğŸ”¥  Creating docker container (CPUs=4, Memory=4096MB) ...
   ğŸ³  æ­£åœ¨ Docker 20.10.17 ä¸­å‡†å¤‡ Kubernetes v1.24.3â€¦
   ğŸ”  Verifying Kubernetes components...
       â–ª Using image registry.cn-hangzhou.aliyuncs.com/google_containers/storage-provisioner:v5
   ğŸŒŸ  Enabled addons: default-storageclass, storage-provisioner
   ğŸ„  Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default
   ```

   ä»è¾“å‡ºä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çš„Kubernetesé›†ç¾¤å·²ç»æˆåŠŸåœ¨æˆ‘ä»¬è‡ªå·±çš„ç”µè„‘ä¸Šå¯åŠ¨å¥½äº†ã€‚
4. é›†ç¾¤å¯åŠ¨å®Œæˆåï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è®¿é—®é›†ç¾¤å‘¢ï¼Ÿåœ¨k3séƒ¨åˆ†çš„ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ `kubectl`è¿™ä¸ªå·¥å…·ï¼ˆè¿˜è®°å¾—é‚£ä¸ª `kubectl get nodes`å‘½ä»¤å—ï¼Ÿï¼‰k3såœ¨å®‰è£…çš„æ—¶å€™é»˜è®¤ä¼šå®‰è£… `kubectl`ï¼Œminikubeä¹Ÿä¼šè‡ªåŠ¨ä¸‹è½½ `kubectl`è¿™ä¸ªå·¥å…·ï¼Œä½†ä½¿ç”¨èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ¨èæ‰‹åŠ¨å®‰è£…ä¸€ä¸‹ `kubectl`ã€‚å…·ä½“å®‰è£…æ–¹æ³•åœ¨[Kubernetesçš„æ–‡æ¡£](https://kubernetes.io/docs/tasks/tools/#kubectl)ä¸­å†™å¾—éå¸¸è¯¦ç»†ï¼ŒæŒ‰ç…§å…¶è¯´æ˜è‡ªè¡Œå®‰è£…å³å¯ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚
   ![](download/icq8sSN.png)
5. æœ€åï¼Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ `kubectl get node`æ¥éªŒè¯é›†ç¾¤çš„å®‰è£…æƒ…å†µï¼š

   ```shell
   $ kubectl get node
   NAME       STATUS   ROLES           AGE   VERSION
   minikube   Ready    control-plane   22h   v1.24.3
   ```

### ä½¿ç”¨Kuberneteså¯åŠ¨ç¬¬ä¸€ä¸ªå®¹å™¨

å‰é¢æåˆ°ï¼ŒKubernetesæœ€å¤§çš„ä½œç”¨å°±æ˜¯ç”¨æ¥â€œç®¡ç†å®¹å™¨â€ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªKubernetesæ“ä½œå°±ä»â€œåˆ›å»ºä¸€ä¸ªå®¹å™¨â€å¼€å§‹ã€‚

æ‰§è¡Œï¼š

```shell
kubectl run first-container --image=docker.io/library/nginx --port=80
```

ä¸Šè¿°å‘½ä»¤æ˜¯è‡ªè§£é‡Šçš„ï¼Œè¡¨ç¤ºä½¿ç”¨ `kubectl`åˆ›å»ºä¸€ä¸ªåä¸º `first-contaier`çš„å®¹å™¨ï¼Œåˆ›å»ºè¯¥å®¹å™¨ä½¿ç”¨çš„é•œåƒæ˜¯ `docker.io/library/nginx`ï¼Œå¹¶åœ¨åˆ›å»ºå®Œå®¹å™¨åï¼Œæš´éœ²å‡ºå®¹å™¨çš„ `80`ç«¯å£ã€‚

> ä¸Šè¿°çš„â€œåˆ›å»ºä¸€ä¸ªåä¸º `first-contaier`çš„å®¹å™¨â€çš„è¡¨è¿°å¹¶ä¸å‡†ç¡®ï¼Œåé¢ä¼šè¯¦ç»†è§£é‡Šã€‚

![](download/rBIa9W3.png)

æ‰§è¡Œå®Œä¸Šè¿°å‘½ä»¤åï¼Œæˆ‘ä»¬å¯ä»¥æ¥ç€ä½¿ç”¨ `kubectl get pod`æŸ¥çœ‹å½“å‰æ‰€åˆ›å»ºçš„å®¹å™¨çš„çŠ¶æ€ï¼š

![](download/VEsL5y2.png)

å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰è¿™ä¸ª `fist-container`çš„ `STATUS`æ˜¯ `ContainerCreating`ï¼Œè¡¨ç¤ºå®¹å™¨æ­£åœ¨è¢«åˆ›å»ºã€‚ç¨ç­‰ä¸€ä¼šå„¿æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ï¼š

![](download/yXQkeUH.png)

æ­¤æ—¶å®¹å™¨çš„ `STATUS`æ˜¯ `Running`ï¼Œè¡¨ç¤ºå®¹å™¨å·²ç»æˆåŠŸè¿è¡Œäº†ã€‚

å‰é¢æˆ‘ä»¬è¿˜æåˆ°ï¼ŒKuberneteså¹¶ä¸ä¼šæ›¿ä»£Dockerå®¹å™¨è¿è¡Œæ—¶çš„å·¥ä½œï¼Œè€Œåªæ˜¯ä½œä¸ºä¸€ä¸ªç®¡ç†è€…åœ¨ä¸Šå±‚å­˜åœ¨ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„è¿™ä¸ª `first-contaienr`æœ¬è´¨ä¸Šåº”è¯¥æ˜¯Dockerå®¹å™¨è¿è¡Œæ—¶â€œä»£åŠ³â€çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¯ä»¥ä½¿ç”¨ `docker ps`çœ‹åˆ°åˆšæ‰çš„åˆ›å»ºçš„å®¹å™¨ã€‚äº‹å®ä¹Ÿç¡®å®å¦‚æ­¤ã€‚

![](download/BH1XR8y.png)

æˆ‘ä»¬å†æ¥å¯¹æ¯”ä¸€ä¸‹ä½¿ç”¨Kubernetesåˆ›å»ºå®¹å™¨å’Œä½¿ç”¨Dockeråˆ›å»ºå®¹å™¨çš„å¼‚åŒï¼š

![](download/RFXpJ1p.png)

è‡³æ­¤ï¼Œæƒ³å¿…å¤§å®¶å·²ç»å¯¹Kubernetesæœ‰äº†éå¸¸æœ´ç´ çš„åˆæ­¥è®¤çŸ¥ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹Kubernetesçš„ä¸€äº›åŸºç¡€æ¦‚å¿µã€‚

## Pod

æƒ³å¿…ç»†å¿ƒçš„åŒå­¦å·²ç»å‘ç°äº†ï¼Œå‰é¢åœ¨ä½¿ç”¨ `kubectl run`åˆ›å»ºå®¹å™¨çš„æ—¶å€™ï¼Œå‘½ä»¤è¿”å›çš„æç¤ºä¿¡æ¯æ˜¯ `pod/first-container created`ï¼š

![](download/qWgiOVm.png)

æ„æ€æ˜¯ï¼Œä¸€ä¸ªåä¸º `first-container`çš„podè¢«åˆ›å»ºäº†ã€‚æˆ‘ä»¬åˆ›å»ºçš„ä¸æ˜¯å®¹å™¨å—ï¼Ÿè¿™ä¸ªâ€œpodâ€æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ

Podæ˜¯Kubernetesä¸­çš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œå³ç®¡ç†ã€åˆ›å»ºã€è®¡åˆ’çš„æœ€å°å•å…ƒï¼ˆè€Œä¸æ˜¯**å®¹å™¨**ï¼‰ã€‚ä¸€ä¸ªPodä¸­å¯ä»¥åŒ…å«å¤šä¸ªå®¹å™¨ï¼Œå¯ä»¥æŠŠPodç†è§£ä¸ºâ€œå®¹å™¨ç»„â€ã€‚åœ¨è‹±æ–‡ä¸­ï¼Œpodçš„æ„æ€æ˜¯â€œè±†èšâ€ï¼Œè±†èšä¸­ä¸€èˆ¬ä¼šåŒ…å«å¤šä¸ªè±†å­ï¼Œè±†èšå’Œè±†å­çš„å…³ç³»å°±ç±»ä¼¼äºPodå’Œå®¹å™¨çš„å…³ç³»ã€‚Podå†…çš„å„ä¸ªå®¹å™¨å…±äº«ç½‘ç»œå’Œå­˜å‚¨ã€‚æ¯”å¦‚å¯ä»¥ä½¿ç”¨localhostäº’ç›¸é€šä¿¡ã€‚

![](download/XVqHtBc.png)

åœ¨ä¸Šä¸€å°èŠ‚çš„â€œä½¿ç”¨Kuberneteså¯åŠ¨ç¬¬ä¸€ä¸ªå®¹å™¨â€ä¸­ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªåä¸ºâ€œfirst-containerâ€çš„Podï¼Œè¿™ä¸ªPodä¸­åŒ…å«äº†ä¸€ä¸ªNginx Containerï¼Œè€Œè¿™ä¸ªcontainerï¼Œæ°æ°æ˜¯æˆ‘ä»¬ä½¿ç”¨ `docker ps`çœ‹åˆ°çš„é‚£ä¸ªå®¹å™¨ã€‚

![](download/5x1MNrv.jpg)

### æŸ¥çœ‹Pod

Kubernetesçš„æ¥å£éå¸¸ `RESTful`ï¼Œå³å¯¹å…¶è¿›è¡Œçš„ä»»ä½•æ“ä½œéƒ½å¯ä»¥å½’ç»“ä¸ºå¯¹å„ç§èµ„æºçš„å¢åˆ æ”¹æŸ¥ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬æƒ³æŸ¥çœ‹å½“å‰é›†ç¾¤ä¸­çš„Podæ—¶ï¼Œåªéœ€è¦ä½¿ç”¨ `get`æ–¹æ³• `kubectl get pod`ï¼š

![](download/a4zywa8.png)

å¦‚æœä½ å·²ç»çŸ¥é“äº†è‡ªå·±è¦æŸ¥çœ‹çš„Podåå­—ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šåç§°ï¼Œä¾‹å¦‚ `kubectl get pod first-container`ï¼š

![](download/jYeie75.png)

å¯ä»¥ä½¿ç”¨ `-o wide`å‚æ•°æŸ¥çœ‹Podæ›´è¯¦ç»†çš„å†…å®¹ï¼š

![](download/4H1HkQ4.png)

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šè¿°å‘½ä»¤çš„è¾“å‡ºä¸­ï¼ŒåŒ…å«äº†Podçš„IPï¼Œè¿™ä¸ªIPæ˜¯æˆ‘ä»¬è®¿é—®å®¹å™¨çš„é‡è¦å·¥å…·ã€‚ç”±äºæˆ‘ä»¬åœ¨ `first-container`ä¸­å¯åŠ¨çš„æ˜¯ä¸€ä¸ªNginx Containerï¼Œå¹¶ä¸”æš´éœ²äº†80ç«¯å£ï¼Œå› æ­¤ï¼Œå¯ä»¥é€šè¿‡è¯¥IPçš„80ç«¯å£è®¿é—®åˆ°Nginx Containerï¼š

![](download/47u2p6X.png)

### åˆ é™¤Pod

åˆ é™¤Podå¾ˆç®€å•ï¼š

```txt
$ kubectl delete pod first-container
pod "first-container" deleted
```

### Podçš„ç”Ÿå‘½å‘¨æœŸ

`kubectl get pod`ä¸­ä½¿ç”¨ `--watch`å‚æ•°å¯ä»¥ç›‘æ§é›†ç¾¤ä¸­Podçš„å˜åŒ–ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨ `--watch`å‚æ•°æ¥å­¦ä¹ Podçš„ç”Ÿå‘½å‘¨æœŸã€‚

é¦–å…ˆæ‰“å¼€ä¸¤ä¸ªç»ˆç«¯çª—å£ã€‚åœ¨å…¶ä¸­ä¸€ä¸ªç»ˆç«¯ä¸­ï¼Œè¾“å…¥ `kubectl get pod --watch`ã€‚è¯¥å‘½ä»¤ä¸ä¼šç«‹å³è¿”å›ï¼Œè€Œæ˜¯ä¼šæŒç»­ä¸€æ®µæ—¶é—´ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œé›†ç¾¤ä¸­Podå‘ç”Ÿçš„å˜åŒ–éƒ½ä¼šåœ¨è¯¥ç»ˆç«¯ä¸­è¾“å‡ºï¼š

![](download/xn2ZmU5.png)

ç„¶åï¼Œæˆ‘ä»¬åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­ï¼Œä¾æ¬¡æ‰§è¡ŒPodçš„åˆ›å»ºæ“ä½œï¼š

![](download/jPqQn7s.png)

è€å¿ƒç­‰å¾…ä¸€ä¼šå„¿ï¼Œæ³¨æ„è§‚å¯Ÿå·¦ä¾§ç»ˆç«¯çª—å£çš„å˜åŒ–ã€‚å¯ä»¥å‘ç°ï¼Œåä¸º `first-container`çš„Podè¢«åˆ›å»ºï¼Œå…¶çŠ¶æ€

1. æœ€å¼€å§‹æ˜¯ `Pending`ï¼Œè¡¨ç¤ºPodå·²ç»è¢«Kubernetesç³»ç»Ÿæ¥å—ï¼Œæ­£åœ¨ç­‰å¾…è¢«åˆ›å»ºã€‚
2. ç„¶å `ContainerCreating`ï¼Œè¡¨ç¤ºPodä¸­çš„å®¹å™¨æ­£åœ¨è¢«åˆ›å»ºä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šä»ç½‘ç»œæ‹‰å–é•œåƒï¼Œæ‰€ä»¥å¯èƒ½èŠ±è´¹è¾ƒé•¿æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œçŠ¶æ€ä¸å¥½çš„æ—¶å€™ã€‚
3. æœ€åæ˜¯ `Running`ï¼Œå¹¶ä¸”å…¶çŠ¶æ€å°†æœ€ç»ˆåœç•™åœ¨ `Running`ã€‚å½“PodçŠ¶æ€ä¸º `Running`æ—¶ï¼Œè¯´æ˜å…¶å·²ç»è¢«æˆåŠŸåˆ›å»ºå¹¶æ­£å¸¸è¿è¡Œäº†ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬åœ¨å³ä¾§çš„ç»ˆç«¯çª—å£ä¸­ï¼Œåˆ é™¤åˆšåˆ›å»ºçš„Podï¼š

![](download/MAmv5Gt.png)

å¯ä»¥çœ‹åˆ°ï¼ŒPodçš„çŠ¶æ€å˜æˆäº† `Terminating`ï¼ˆä¸­æ­¢ï¼‰ï¼Œå¹¶æœ€ç»ˆä¸å†å˜åŒ–ï¼ˆè¢«åˆ é™¤äº†ï¼‰ã€‚

### ä½¿ç”¨YAMLæ–‡ä»¶ç®¡ç†Pod

é€šç•…æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä¼šç›´æ¥ä½¿ç”¨ `kubectl run`è¿™æ ·çš„å‘½ä»¤è¡Œæ¥ç®¡ç†å®¹å™¨ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ª[YAMLæ ¼å¼](https://yaml.org/)çš„æ–‡ä»¶æ¥æè¿°Podã€‚æ¯”å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„Podçš„YAMLæè¿°ï¼š

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-yaml
spec:
  containers:
  - name: nginx
    image: nginx:1.14.2
    ports:
    - containerPort: 80
```

[YAMLæ ¼å¼](https://yaml.org/)å’ŒJSONã€XMLä¸€æ ·ï¼Œæ˜¯ä¸€ç§ç”¨äºé…ç½®æè¿°è¯­è¨€ï¼ˆç®€å•æ¥è¯´å°±æ˜¯è¿™ç§è¯­è¨€ä¸€èˆ¬ç”¨æ¥å†™é…ç½®æ–‡ä»¶ï¼‰ã€‚YAMLçš„è¯­æ³•éå¸¸ç®€å•ï¼ŒåŸºæœ¬ç”±KVé”®å€¼å¯¹ç»„æˆï¼Œå¹¶ä¸”ä½¿ç”¨ç¼©è¿›æ¥è¡¨ç¤ºåµŒå¥—å…³ç³»ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¥è¯¦ç»†è¯´æ˜ä¸€ä¸‹ä¸Šè¿°è¿™ä¸ªPodçš„YAMLæ–‡ä»¶ä¸­å„ä¸ªå­—æ®µçš„å«ä¹‰ã€‚

- `apiVersion: v1`è¡¨ç¤ºè¯¥Podæè¿°é€‚ç”¨çš„Kubernetesçš„Podçš„APIç‰ˆæœ¬æ˜¯v1ï¼ˆå¦‚æœä¸ç†è§£ä¹Ÿé—®é¢˜ä¸å¤§ï¼Œä¸å½±å“åç»­çš„å­¦ä¹ ï¼‰
- `kind: Pod`è¡¨ç¤ºå½“å‰è¿™ä¸ªYAMLæè¿°ï¼Œæè¿°çš„å¯¹è±¡æ˜¯ä¸€ä¸ªPod
- `metadata`è¡¨ç¤ºâ€œå…ƒä¿¡æ¯â€ï¼Œä¸€èˆ¬ä¼šåœ¨è¿™é‡Œæè¿°Podçš„åå­—ã€å‘½åç©ºé—´ç­‰â€œèº«ä»½è¯†åˆ«ä¿¡æ¯â€ã€‚æ³¨æ„ï¼Œ`metadata`åé¢æ²¡æœ‰å€¼ï¼Œè€Œä¸”ç¬¬äºŒè¡Œç¼©è¿›ï¼Œè¡¨ç¤º `metadata`çš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«ä¸‹é¢ç¼©è¿›ä¸­çš„è‹¥ä¸ªé”®å€¼å¯¹
  - `name: nginx-yaml`è¡¨ç¤ºï¼Œè¯¥Podçš„åå­—æ˜¯ `nginx-yaml`ã€‚å®ƒä½äº `metadata`çš„ç¼©è¿›ä¸­ï¼Œè¡¨ç¤ºå…¶æ˜¯ `metadata`çš„å€¼çš„ä¸€éƒ¨åˆ†ã€‚
- `spec`æ˜¯å¯¹Podçš„å…·ä½“æè¿°
  - `containers`æè¿°äº†Podä¸­ä¼šåŒ…å«å“ªäº›å®¹å™¨ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå…¶ç¬¬äºŒè¡Œçš„ `- name: nginx`æ˜¯ä»¥ `- `å¼€å¤´çš„ï¼Œè¿™è¯´æ˜ï¼Œcontainersçš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº† `name`ã€`image`ã€`ports`ç­‰é”®å€¼å¯¹
    - `name: nginx`è¡¨ç¤ºå®¹å™¨çš„åå­—æ˜¯ `nginx`ã€‚è¿™ä¸ªåå­—å…¶å®æ²¡æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œç¬¦åˆå‘½åè§„èŒƒçš„æƒ…å†µä¸‹ï¼Œéšä¾¿å†™å°±è¡Œ
    - `image: nginx:1.14.2`è¡¨ç¤ºè¿™ä¸ªå®¹å™¨ä½¿ç”¨çš„é•œåƒæ˜¯ `nginx:1.14.2`
    - `ports`è¡¨ç¤ºå®¹å™¨ä¼šå‘å¤–æš´éœ²å“ªäº›ç«¯å£

å°†ä¸Šè¿°Podçš„YAMLæè¿°ä¿å­˜åˆ°ä¸€ä¸ªYAMLæ–‡ä»¶ä¸­ï¼Œå¦‚ `pod-demo.yaml`ï¼Œç„¶åæ‰§è¡Œ `kubectl apply -f pod-demo.yaml`ï¼Œå³å¯å°†è¯¥Pod `apply`åˆ°Kubernetesé›†ç¾¤ä¸­ã€‚

`apply`çš„å«ä¹‰æ˜¯ï¼Œ

- å¦‚æœå½“å‰é›†ç¾¤ä¸­ä¸å­˜åœ¨å­˜åœ¨æ–‡ä»¶ä¸­å¯¹æè¿°çš„èµ„æºï¼Œé‚£å°†åˆ›å»ºè¯¥èµ„æºï¼›
- å¦‚æœå·²ç»å­˜åœ¨äº†ï¼Œåˆ™æ ¹æ®YAMLæ–‡ä»¶ä¸­çš„æè¿°å¯¹èµ„æºè¿›è¡Œæ›´æ–°ã€‚

å› æ­¤ï¼Œåœ¨æˆ‘ä»¬æ‰§è¡Œå®Œ `kubectl apply -f pod-demo.yaml`ï¼ŒKuberneteså°†ä¼šåˆ›å»ºä¸€ä¸ªåä¸º `nginx-yaml`çš„Podã€‚

![](download/Bdv52vB.png)

ç±»ä¼¼åœ°ï¼Œ`kubectl delete -f pod-demo.yaml`å°†ä¼šæŠŠ `pod-demo.yaml`æ–‡ä»¶ä¸­å®šä¹‰çš„èµ„æºåˆ é™¤ã€‚

> `apply`æ“ä½œä½“ç°çš„æ˜¯Kubernetesçš„**å£°æ˜å¼ç¼–ç¨‹**çš„æ€æƒ³ï¼Œå³ï¼Œæˆ‘å‘Šè¯‰ä½ æˆ‘æƒ³è¦å•¥ï¼ˆæˆ‘åªæä¾›ä¸€ä¸ªYAMLæ–‡ä»¶ï¼Œå³æˆ‘å¸Œæœ›æœ€ç»ˆè¿™ä¸ªPodçš„æ ·å­æ˜¯ä»€ä¹ˆï¼‰ï¼Œå…·ä½“æ€ä¹ˆåšç”±ä½ æ¥è´Ÿè´£ï¼ˆä½ æ€ä¹ˆåˆ›å»ºPodï¼Œæ€ä¹ˆå¯åŠ¨Containerï¼Œæ˜¯ä½ Kubernetesçš„äº‹ï¼Œè·Ÿæˆ‘æ— å…³ï¼‰ã€‚å…¶å®ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„SQLå°±æœ‰å£°æ˜å¼ç¼–ç¨‹çš„å½±å­ã€‚æ¯”å¦‚ä¸€æ¡ `SELECT`è¯­å¥ï¼Œæˆ‘ä»¬åªæ˜¯å‘Šè¯‰æ•°æ®åº“æˆ‘ä»¬æƒ³æŸ¥ä»€ä¹ˆä¸œè¥¿ï¼Œä½†å…·ä½“æ€ä¹ˆæŸ¥ï¼Œä½¿ç”¨å“ªä¸ªç´¢å¼•è¿˜æ˜¯åˆ«çš„ä»€ä¹ˆä¸œè¥¿ï¼Œä½œä¸ºç”¨æˆ·çš„æˆ‘ä»¬å¹¶ä¸å…³å¿ƒã€‚ä¸å£°æ˜å¼ç¼–ç¨‹ç›¸å¯¹çš„æ˜¯å‘½ä»¤å¼ç¼–ç¨‹ï¼Œå³éœ€è¦ç”¨æˆ·è‡ªå·±å°†é—®é¢˜æ‹†è§£ï¼Œå‘Šè¯‰æ‰§è¡Œå™¨è¯¥æ€æ ·ä¸€æ­¥æ­¥åœ°è§£å†³é—®é¢˜ã€‚

> åœ¨æˆ‘ä»¬åç»­çš„å­¦ä¹ ä¸­ï¼Œå‡ ä¹æ‰€æœ‰çš„èµ„æºéƒ½ä¼šä½¿ç”¨YAMLæ–‡ä»¶æ¥æè¿°ã€‚YAMLåœ¨Kubernetesä¸­ä½¿ç”¨éå¸¸å¹¿æ³›ï¼Œå› æ­¤æœ‰äº›äº‘è®¡ç®—å·¥ç¨‹å¸ˆç»å¸¸è‡ªå˜²è‡ªå·±æ˜¯â€œYAMLå·¥ç¨‹å¸ˆâ€ã€‚

![](download/bip6xtI.png)

## Label

Kubernetesæ”¯æŒç»™èµ„æºå¯¹è±¡æ‰“æ ‡ç­¾ï¼ˆLabelï¼‰ã€‚Podæ˜¯Kubernetesä¸­æœ€åŸºæœ¬çš„èµ„æºå¯¹è±¡ï¼Œè‡ªç„¶ä¹Ÿæ”¯æŒæ‰“æ ‡ç­¾ï¼ˆLabelï¼‰ã€‚

è¿™é‡Œæ‰€è¯´çš„æ ‡ç­¾ï¼Œå…¶å®å°±æ˜¯ä¸€ç»„é”®å€¼å¯¹ï¼ˆkey-valueï¼‰ï¼Œå†…å®¹æ²¡æœ‰é™åˆ¶ï¼Œåªè¦keyä¸é‡å¤ï¼Œå†™å•¥éƒ½è¡Œï¼›å¹¶ä¸”Labeléœ€è¦å†™åœ¨ `metadata`é‡Œã€‚

æ¯”å¦‚ï¼Œç»™ä¸Šä¸€å°èŠ‚ç”¨åˆ°çš„ `nginx-yaml`åŠ ä¸Šæ ‡ç­¾çš„è¯ï¼Œåº”è¯¥æ˜¯ï¼š

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-yaml
  labels:
    kkk: hahaha
    hhh: hahaha
    kubernetes: yyds
spec:
  containers:
  - name: nginx
    image: nginx:1.14.2
    ports:
    - containerPort: 80
```

ä¸Šé¢çš„ä»£ç ç»™PodåŠ ä¸Šäº†ä¸‰ä¸ªæ ‡ç­¾ï¼Œ`kkk: hahaha`ï¼Œ`hhh: hahaha`ï¼Œ`kubernetes: yyds`ã€‚

æˆ‘ä»¬å°†ä¿®æ”¹åçš„ `pod-demo.yaml`é‡æ–° `apply`ä¸€ä¸‹ï¼Œå³å¯ç»™Podæ‰“ä¸Šè¿™ä¸‰ä¸ªæ ‡ç­¾ï¼š

![](download/R83PBEH.png)

ä»è¾“å‡ºå†…å®¹å¯ä»¥çœ‹å‡ºï¼Œ`nginx-yaml`è¿™ä¸ªpodè¢«æ›´æ–°äº†ã€‚

å¦‚ä½•éªŒè¯æˆ‘ä»¬è®¾ç½®çš„æ ‡ç­¾ç”Ÿæ•ˆäº†å‘¢ï¼Ÿå¯ä»¥åœ¨ `kubectl get pod`çš„æ—¶å€™ä½¿ç”¨ `-l`å‚æ•°ï¼Œä¾‹å¦‚ `kubectl get pod -l kkk=hahaha`å°±å°†è¿”å›é‚£äº›è¢«æ‰“ä¸Š `kkk: hahaha`æ ‡ç­¾çš„Podï¼š

![](download/5ytuye4.png)

å¯ä»¥æƒ³åˆ°ï¼Œå¦‚æœä½¿ç”¨ `kubectl get pod -l kkk=hiahiahia`ï¼Œé‚£å°†æ²¡æœ‰ä»»ä½•ç»“æœï¼š

![](download/H3GadkW.png)

åŸºäºLabelé€‰å–å¯¹åº”çš„èµ„æºï¼Œæ˜¯Kubernetesä¸­éå¸¸é‡è¦çš„åœ¨ä¸åŒç±»å‹çš„èµ„æºå¯¹è±¡é—´å»ºç«‹è”ç³»çš„æ–¹å¼ã€‚

## å®éªŒæŠ¥å‘Šæ¨¡æ¿

```md
# KubernetesåŸºç¡€å®éªŒæŠ¥å‘Š

## ä¸ªäººä¿¡æ¯

å§“åï¼š
å­¦å·ï¼š

## å®éªŒå†…å®¹

### å¯åŠ¨Kubernetesé›†ç¾¤

<!-- å¯ä»¥æ ¹æ®è‡ªèº«æƒ…å†µé€‰æ‹©é›†ç¾¤ç‰ˆæˆ–å•æœºç‰ˆï¼Œé€‰æ‹©å…¶ä¸€å³å¯ -->
<!-- è¯·è¯¦ç»†å†™å‡ºè‡ªå·±çš„æ“ä½œæ­¥éª¤ï¼Œå¹¶æˆªå›¾è¯´æ˜ -->

### ä½¿ç”¨Kuberneteså¯åŠ¨ç¬¬ä¸€ä¸ªå®¹å™¨

<!--  ä½¿ç”¨kubectl runå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå¹¶ä¸docker runè¿›è¡Œæ¯”è¾ƒ -->
<!-- è¯·è¯¦ç»†å†™å‡ºè‡ªå·±çš„æ“ä½œæ­¥éª¤ï¼Œå¹¶æˆªå›¾è¯´æ˜ -->

### è§‚å¯ŸPodçš„ç”Ÿå‘½å‘¨æœŸ

<!-- ç»“åˆ kubectl get pod --watch å’Œpodçš„åˆ›å»ºã€åˆ é™¤æ“ä½œï¼Œè§‚å¯ŸPodçš„ç”Ÿå‘½å‘¨æœŸ -->
<!-- è¯·è¯¦ç»†å†™å‡ºè‡ªå·±çš„æ“ä½œæ­¥éª¤ï¼Œå¹¶æˆªå›¾è¯´æ˜ -->

### ä½¿ç”¨YAMLæ–‡ä»¶ç®¡ç†Pod

<!-- ä½¿ç”¨YAMLæ–‡ä»¶çš„æ–¹å¼åˆ›å»ºPodã€æŸ¥çœ‹Podã€åˆ é™¤Pod -->
<!-- è¯·è¯¦ç»†å†™å‡ºè‡ªå·±çš„æ“ä½œæ­¥éª¤ï¼Œå¹¶æˆªå›¾è¯´æ˜ -->

### ä¸ºPodæ·»åŠ Label

<!-- ä½¿ç”¨YAMLæ–‡ä»¶åˆ›å»ºPodåï¼Œç¼–è¾‘YAMLæ–‡ä»¶ï¼Œä¸ºPodæ·»åŠ Labelï¼Œå¹¶éªŒè¯ä¹‹ -->
<!-- è¯·è¯¦ç»†å†™å‡ºè‡ªå·±çš„æ“ä½œæ­¥éª¤ï¼Œå¹¶æˆªå›¾è¯´æ˜ -->
```
