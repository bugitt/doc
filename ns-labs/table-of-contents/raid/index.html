<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Lab01 RAID阵列 # 本指导书是实验过程的一个示例，供不熟悉实验环境的同学参考，无需严格按照指导书中的步骤来进行实验 :)
实验内容 # 本实验通过软件 RAID 管理磁盘：
通过工具查看磁盘列表 [仅Windows] C 盘扩展卷，检查其它磁盘是否联机，联机并初始化磁盘 [仅Ubuntu] 使用LVM扩展根目录/的容量 创建RAID阵列，测试读写文件并模拟磁盘损坏，观察有什么情况发生，数据是否损坏或者丢失？ 尝试RAID 0 尝试RAID 1 尝试RAID 5 [选做] 控制变量，测试RAID阵列的读写速率，并结合理论分析实验结果 [选做] 自行设计与扩展，体会 RAID 0 1 5 10 等方案下，在遇到磁盘损坏故障、冗余备份的效果等 [选做] 思考题： 为什么及在什么条件下选择用 RAID RAID & 分布式存储 & 集中存储的区别 其中，选做的题目不计入本实验的总得分，仅额外加分
实验报告模板分别是lab01_win.md和lab01_ubuntu.md，供参考使用，最后请将实验报告按 lab01-学号-姓名.pdf 的命名格式提交
实验准备 # Windows下连接Windows 10虚拟机 # 使用系统自带的“远程桌面连接”即可
MacOS下连接Windows 10虚拟机 # 使用Microsoft Remote Desktop连接，云平台课程资源页提供该软件的下载
Windows下连接Ubuntu虚拟机 # 一般来讲，Windows 10（及以上）自带的cmd.exe都自带ssh client，打开cmd后直接ssh foo@x.x.x.x即可登录
为了更好的使用体验，推荐下载使用 Windows Terminal
当然，你也可以使用 termius 或者其他工具（如 Xshell等）进行多个ssh连接的管理"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Lab01 RAID 阵列"><meta property="og:description" content="Lab01 RAID阵列 # 本指导书是实验过程的一个示例，供不熟悉实验环境的同学参考，无需严格按照指导书中的步骤来进行实验 :)
实验内容 # 本实验通过软件 RAID 管理磁盘：
通过工具查看磁盘列表 [仅Windows] C 盘扩展卷，检查其它磁盘是否联机，联机并初始化磁盘 [仅Ubuntu] 使用LVM扩展根目录/的容量 创建RAID阵列，测试读写文件并模拟磁盘损坏，观察有什么情况发生，数据是否损坏或者丢失？ 尝试RAID 0 尝试RAID 1 尝试RAID 5 [选做] 控制变量，测试RAID阵列的读写速率，并结合理论分析实验结果 [选做] 自行设计与扩展，体会 RAID 0 1 5 10 等方案下，在遇到磁盘损坏故障、冗余备份的效果等 [选做] 思考题： 为什么及在什么条件下选择用 RAID RAID & 分布式存储 & 集中存储的区别 其中，选做的题目不计入本实验的总得分，仅额外加分
实验报告模板分别是lab01_win.md和lab01_ubuntu.md，供参考使用，最后请将实验报告按 lab01-学号-姓名.pdf 的命名格式提交
实验准备 # Windows下连接Windows 10虚拟机 # 使用系统自带的“远程桌面连接”即可
MacOS下连接Windows 10虚拟机 # 使用Microsoft Remote Desktop连接，云平台课程资源页提供该软件的下载
Windows下连接Ubuntu虚拟机 # 一般来讲，Windows 10（及以上）自带的cmd.exe都自带ssh client，打开cmd后直接ssh foo@x.x.x.x即可登录
为了更好的使用体验，推荐下载使用 Windows Terminal
当然，你也可以使用 termius 或者其他工具（如 Xshell等）进行多个ssh连接的管理"><meta property="og:type" content="article"><meta property="og:url" content="https://scs.buaa.edu.cn/doc/ns-labs/table-of-contents/raid/"><meta property="article:section" content="ns-labs"><meta property="article:modified_time" content="2022-10-29T22:47:00+08:00"><title>Lab01 RAID 阵列 | 软院云平台文档</title><link rel=manifest href=/doc/manifest.json><link rel=icon href=/doc/favicon.png type=image/x-icon><link rel=stylesheet href=/doc/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css integrity="sha256-RhgbyTN1upMgJudTs3xA5v+LsWqe93DHi8xmPkV3sbo=" crossorigin=anonymous><script defer src=/doc/flexsearch.min.js></script>
<script defer src=/doc/en.search.min.69a13a7c4aca55a0dd9504fb549f23bdab48bb93ade464f4f6289c5c793231d2.js integrity="sha256-aaE6fErKVaDdlQT7VJ8jvatIu5Ot5GT09iicXHkyMdI=" crossorigin=anonymous></script>
<script defer src=/doc/sw.min.c6e13cf2801d746c82b18aace5ed50254554a6ab28bdd01a6fd9fdc0d082e427.js integrity="sha256-xuE88oAddGyCsYqs5e1QJUVUpqsovdAab9n9wNCC5Cc=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/doc/><span>软院云平台文档</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://scs.buaa.edu.cn/doc/02_bugit/>BuGit代码托管与自动部署平台</a><ul><li><a href=https://scs.buaa.edu.cn/doc/02_bugit/build_deploy/>自动构建与部署</a></li></ul></li><li><a href=https://scs.buaa.edu.cn/doc/01_common/>云平台使用手册</a><ul><li><a href=https://scs.buaa.edu.cn/doc/01_common/virtual_machine_help/>虚拟机使用说明</a></li></ul></li><li><a href=https://scs.buaa.edu.cn/doc/cloud-labs/>大数据和云计算综合实践</a><ul><li><a href=https://scs.buaa.edu.cn/doc/cloud-labs/cloud/>云计算实验</a><ul><li><a href=https://scs.buaa.edu.cn/doc/cloud-labs/cloud/container_docker/>容器与Docker综合实验</a></li><li><a href=https://scs.buaa.edu.cn/doc/cloud-labs/cloud/cloud_course_design/>云计算课程设计</a></li><li><a href=https://scs.buaa.edu.cn/doc/cloud-labs/cloud/kube-single-3/>Kubernetes综合实验</a></li><li><a href=https://scs.buaa.edu.cn/doc/cloud-labs/cloud/faq/>FAQ</a></li></ul></li></ul></li><li><a href=https://scs.buaa.edu.cn/doc/ns-labs/>网络存储实验规划</a><ul><li><a href=https://scs.buaa.edu.cn/doc/ns-labs/table-of-contents/>Table of Contents</a><ul><li><a href=https://scs.buaa.edu.cn/doc/ns-labs/table-of-contents/raid/ class=active>Lab01 RAID 阵列</a></li><li><a href=https://scs.buaa.edu.cn/doc/ns-labs/table-of-contents/virtualization/>Lab02 虚拟化实验</a></li></ul></li><li><a href=https://scs.buaa.edu.cn/doc/ns-labs/resources/>Resources</a><ul><li><a href=https://scs.buaa.edu.cn/doc/ns-labs/resources/os/>操作系统</a></li></ul></li></ul></li></ul><ul><li><a href=https://github.com/bugitt/doc target=_blank rel=noopener>Github</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/doc/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Lab01 RAID 阵列</strong>
<label for=toc-control><img src=/doc/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#lab01-raid阵列>Lab01 RAID阵列</a><ul><li><a href=#实验内容>实验内容</a></li><li><a href=#实验准备>实验准备</a><ul><li><a href=#windows下连接windows-10虚拟机>Windows下连接Windows 10虚拟机</a></li><li><a href=#macos下连接windows-10虚拟机>MacOS下连接Windows 10虚拟机</a></li><li><a href=#windows下连接ubuntu虚拟机>Windows下连接Ubuntu虚拟机</a></li><li><a href=#macos下连接ubuntu虚拟机>MacOS下连接Ubuntu虚拟机</a></li><li><a href=#校外连接ubuntu虚拟机>校外连接Ubuntu虚拟机</a></li><li><a href=#ubuntu虚拟机联网>Ubuntu虚拟机联网</a></li><li><a href=#重要提醒>重要提醒</a></li></ul></li><li><a href=#windows环境>Windows环境</a></li><li><a href=#ubuntu环境>Ubuntu环境</a><ul><li><a href=#使用lvm为根目录扩容>使用LVM为根目录扩容</a></li><li><a href=#raid阵列搭建>RAID阵列搭建</a></li><li><a href=#模拟raid-0阵列中磁盘损坏>模拟RAID 0阵列中磁盘损坏</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=lab01-raid阵列>Lab01 RAID阵列
<a class=anchor href=#lab01-raid%e9%98%b5%e5%88%97>#</a></h1><p>本指导书是实验过程的一个示例，供不熟悉实验环境的同学参考，无需严格按照指导书中的步骤来进行实验 :)</p><h2 id=实验内容>实验内容
<a class=anchor href=#%e5%ae%9e%e9%aa%8c%e5%86%85%e5%ae%b9>#</a></h2><p>本实验通过软件 RAID 管理磁盘：</p><ul><li>通过工具查看磁盘列表</li><li>[仅Windows] C 盘扩展卷，检查其它磁盘是否联机，联机并初始化磁盘</li><li>[仅Ubuntu] 使用LVM扩展根目录<code>/</code>的容量</li><li>创建RAID阵列，测试读写文件并模拟磁盘损坏，观察有什么情况发生，数据是否损坏或者丢失？<ul><li>尝试RAID 0</li><li>尝试RAID 1</li><li>尝试RAID 5</li></ul></li><li>[选做] 控制变量，测试RAID阵列的读写速率，并结合理论分析实验结果</li><li>[选做] 自行设计与扩展，体会 RAID 0 1 5 10 等方案下，在遇到磁盘损坏故障、冗余备份的效果等</li><li>[选做] 思考题：<ul><li>为什么及在什么条件下选择用 RAID</li><li>RAID & 分布式存储 & 集中存储的区别</li></ul></li></ul><p>其中，选做的题目不计入本实验的总得分，仅额外加分</p><p>实验报告模板分别是<code>lab01_win.md</code>和<code>lab01_ubuntu.md</code>，供参考使用，最后请将实验报告按 <code>lab01-学号-姓名.pdf</code> 的命名格式提交</p><h2 id=实验准备>实验准备
<a class=anchor href=#%e5%ae%9e%e9%aa%8c%e5%87%86%e5%a4%87>#</a></h2><h3 id=windows下连接windows-10虚拟机>Windows下连接Windows 10虚拟机
<a class=anchor href=#windows%e4%b8%8b%e8%bf%9e%e6%8e%a5windows-10%e8%99%9a%e6%8b%9f%e6%9c%ba>#</a></h3><p>使用系统自带的“远程桌面连接”即可</p><h3 id=macos下连接windows-10虚拟机>MacOS下连接Windows 10虚拟机
<a class=anchor href=#macos%e4%b8%8b%e8%bf%9e%e6%8e%a5windows-10%e8%99%9a%e6%8b%9f%e6%9c%ba>#</a></h3><p>使用Microsoft Remote Desktop连接，云平台课程资源页提供该软件的下载</p><h3 id=windows下连接ubuntu虚拟机>Windows下连接Ubuntu虚拟机
<a class=anchor href=#windows%e4%b8%8b%e8%bf%9e%e6%8e%a5ubuntu%e8%99%9a%e6%8b%9f%e6%9c%ba>#</a></h3><p>一般来讲，Windows 10（及以上）自带的cmd.exe都自带ssh client，打开cmd后直接<code>ssh foo@x.x.x.x</code>即可登录</p><p>为了更好的使用体验，推荐下载使用
<a href=https://aka.ms/terminal>Windows Terminal</a></p><p>当然，你也可以使用
<a href=https://termius.com/>termius</a> 或者其他工具（如 Xshell等）进行多个ssh连接的管理</p><h3 id=macos下连接ubuntu虚拟机>MacOS下连接Ubuntu虚拟机
<a class=anchor href=#macos%e4%b8%8b%e8%bf%9e%e6%8e%a5ubuntu%e8%99%9a%e6%8b%9f%e6%9c%ba>#</a></h3><p>使用系统自带的Terminal.app登录即可</p><p>为了更好的使用体验，推荐使用
<a href=https://iterm2.com/>iterm2</a> 登录</p><p>当然，你也可以使用
<a href=https://termius.com/>termius</a> 进行多个ssh连接的管理</p><h3 id=校外连接ubuntu虚拟机>校外连接Ubuntu虚拟机
<a class=anchor href=#%e6%a0%a1%e5%a4%96%e8%bf%9e%e6%8e%a5ubuntu%e8%99%9a%e6%8b%9f%e6%9c%ba>#</a></h3><p>在云平台的虚拟机列表中点击“连接”即可
<img src=img/fig0.png alt></p><h3 id=ubuntu虚拟机联网>Ubuntu虚拟机联网
<a class=anchor href=#ubuntu%e8%99%9a%e6%8b%9f%e6%9c%ba%e8%81%94%e7%bd%91>#</a></h3><p>虚拟机已内置联网登录工具</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>buaalogin config
</span></span><span style=display:flex><span>buaalogin login
</span></span></code></pre></div><h3 id=重要提醒>重要提醒
<a class=anchor href=#%e9%87%8d%e8%a6%81%e6%8f%90%e9%86%92>#</a></h3><p>请登录实验虚拟机后，及时更改虚拟机密码，以避免以下情况发生：</p><ul><li>未意识到登录了他人的虚拟机， 帮助别人完成了实验工作</li><li>自己的虚拟机被别人登录，已经做完的实验被破坏</li></ul><h2 id=windows环境>Windows环境
<a class=anchor href=#windows%e7%8e%af%e5%a2%83>#</a></h2><p>点击桌面上的“计算机管理”，在左侧菜单栏打开“计算机管理-存储-磁盘管理”
<img src=img/fig1.jpg alt></p><p>右键点击C盘，选择“扩展卷”，即可把C盘所在磁盘上未分区的80GB空间合并至C盘内
<img src=img/fig2.jpg alt></p><p>右键点击未分配的磁盘，看到可以选择创建跨区卷、带区卷、镜像卷、RAID-5卷，它们分别对应不做条带化的RAID 0、条带化的RAID 0、RAID 1、RAID 5，这里以RAID 5为例
<img src=img/fig3.jpg alt></p><p>选择阵列中包括的磁盘，下一步选中“快速格式化”，最后确认转化为动态磁盘，即可创建阵列
<img src=img/fig4.jpg alt></p><p>点击桌面上的“ATTO 磁盘基准测试”，选择RAID 5阵列所在的盘符，测试读写速度
<img src=img/fig5.jpg alt></p><p>在RAID 5阵列上保存文件，将其中的一块磁盘脱机，模拟磁盘损坏，文件仍然可以正常查看
<img src=img/fig6.jpg alt>
<img src=img/fig7.jpg alt></p><h2 id=ubuntu环境>Ubuntu环境
<a class=anchor href=#ubuntu%e7%8e%af%e5%a2%83>#</a></h2><p>实验全程在root权限下进行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo -i
</span></span></code></pre></div><h3 id=使用lvm为根目录扩容>使用LVM为根目录扩容
<a class=anchor href=#%e4%bd%bf%e7%94%a8lvm%e4%b8%ba%e6%a0%b9%e7%9b%ae%e5%bd%95%e6%89%a9%e5%ae%b9>#</a></h3><p>查看虚拟机上的磁盘列表，其中有sdb~sdf共五块磁盘可以供本次实验使用，sda是系统所在的磁盘，容量为50GB</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ lsblk -d
</span></span><span style=display:flex><span>sda     8:0    <span style=color:#ae81ff>0</span>   50G  <span style=color:#ae81ff>0</span> disk 
</span></span><span style=display:flex><span>sdb     8:16   <span style=color:#ae81ff>0</span>   10G  <span style=color:#ae81ff>0</span> disk 
</span></span><span style=display:flex><span>sdc     8:32   <span style=color:#ae81ff>0</span>   10G  <span style=color:#ae81ff>0</span> disk 
</span></span><span style=display:flex><span>sdd     8:48   <span style=color:#ae81ff>0</span>   10G  <span style=color:#ae81ff>0</span> disk 
</span></span><span style=display:flex><span>sde     8:64   <span style=color:#ae81ff>0</span>   10G  <span style=color:#ae81ff>0</span> disk 
</span></span><span style=display:flex><span>sdf     8:80   <span style=color:#ae81ff>0</span>   10G  <span style=color:#ae81ff>0</span> disk
</span></span></code></pre></div><p>查看根目录<code>/</code>的容量，为15GB，说明sda磁盘上有空闲空间没有利用上</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ df -lh /
</span></span><span style=display:flex><span>Filesystem                         Size  Used Avail Use% Mounted on
</span></span><span style=display:flex><span>/dev/mapper/ubuntu--vg-ubuntu--lv   15G  4.9G  9.1G  35% /
</span></span></code></pre></div><p>使用<code>fdisk</code>命令给空闲的磁盘空间分区</p><p>在<code>Command (m for help):</code>后面输入<code>n</code>，一路回车，默认按磁盘最大容量分区</p><p>在<code>Command (m for help):</code>后面输入<code>t</code>，输入<code>4</code>选择新创建的分区，输入<code>31</code>选择Linux LVM分区类型</p><p>最后在<code>Command (m for help):</code>后面输入<code>w</code>保存</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ fdisk /dev/sda
</span></span><span style=display:flex><span>Command <span style=color:#f92672>(</span>m <span style=color:#66d9ef>for</span> help<span style=color:#f92672>)</span>: n
</span></span><span style=display:flex><span>Partition number <span style=color:#f92672>(</span>4-128, default 4<span style=color:#f92672>)</span>: 
</span></span><span style=display:flex><span>First sector <span style=color:#f92672>(</span>33552384-104857566, default 33552384<span style=color:#f92672>)</span>: 
</span></span><span style=display:flex><span>Last sector, +/-sectors or +/-size<span style=color:#f92672>{</span>K,M,G,T,P<span style=color:#f92672>}</span> <span style=color:#f92672>(</span>33552384-104857566, default 104857566<span style=color:#f92672>)</span>: 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Created a new partition <span style=color:#ae81ff>4</span> of type <span style=color:#e6db74>&#39;Linux filesystem&#39;</span> and of size <span style=color:#ae81ff>34</span> GiB.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Command <span style=color:#f92672>(</span>m <span style=color:#66d9ef>for</span> help<span style=color:#f92672>)</span>: t
</span></span><span style=display:flex><span>Partition number <span style=color:#f92672>(</span>1-4, default 4<span style=color:#f92672>)</span>: <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>Partition type <span style=color:#f92672>(</span>type L to list all types<span style=color:#f92672>)</span>: <span style=color:#ae81ff>31</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Changed type of partition <span style=color:#e6db74>&#39;Linux filesystem&#39;</span> to <span style=color:#e6db74>&#39;Linux LVM&#39;</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Command <span style=color:#f92672>(</span>m <span style=color:#66d9ef>for</span> help<span style=color:#f92672>)</span>: w
</span></span><span style=display:flex><span>The partition table has been altered.
</span></span><span style=display:flex><span>Syncing disks.
</span></span></code></pre></div><p>创建物理卷（PV），命名格式一般为<code>磁盘名+分区号</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pvcreate /dev/sda4
</span></span></code></pre></div><p>查看卷组（VG）列表，Ubuntu在系统安装时已创建好了一个默认的卷组，如下所示</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ vgdisplay
</span></span><span style=display:flex><span>  --- Volume group ---
</span></span><span style=display:flex><span>  VG Name               ubuntu-vg
</span></span><span style=display:flex><span>  ...
</span></span></code></pre></div><p>将刚创建的物理卷加入卷组</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vgextend ubuntu-vg /dev/sda4
</span></span></code></pre></div><p>查看逻辑卷（LV）列表，Ubuntu系统安装在默认逻辑卷上</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ lvdisplay
</span></span><span style=display:flex><span>  --- Logical volume ---
</span></span><span style=display:flex><span>  LV Path                /dev/ubuntu-vg/ubuntu-lv
</span></span><span style=display:flex><span>  ...
</span></span></code></pre></div><p>将逻辑卷扩容，然后为文件系统（ext4类型）扩容</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv
</span></span><span style=display:flex><span>resize2fs /dev/ubuntu-vg/ubuntu-lv
</span></span></code></pre></div><p>查看根目录容量，已扩容至49GB</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ df -lh /
</span></span><span style=display:flex><span>Filesystem                         Size  Used Avail Use% Mounted on
</span></span><span style=display:flex><span>/dev/mapper/ubuntu--vg-ubuntu--lv   49G  4.9G   42G  11% /
</span></span></code></pre></div><h3 id=raid阵列搭建>RAID阵列搭建
<a class=anchor href=#raid%e9%98%b5%e5%88%97%e6%90%ad%e5%bb%ba>#</a></h3><p>安装mdadm工具</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apt-get install mdadm
</span></span></code></pre></div><p><code>mdadm</code>命令的常用参数及作用如下</p><table><thead><tr><th style=text-align:center>参数</th><th style=text-align:center>作用</th></tr></thead><tbody><tr><td style=text-align:center>-a</td><td style=text-align:center>检测设备名称</td></tr><tr><td style=text-align:center>-n</td><td style=text-align:center>指定设备数量</td></tr><tr><td style=text-align:center>-l</td><td style=text-align:center>指定RAID级别</td></tr><tr><td style=text-align:center>-C</td><td style=text-align:center>创建</td></tr><tr><td style=text-align:center>-v</td><td style=text-align:center>显示过程</td></tr><tr><td style=text-align:center>-f</td><td style=text-align:center>模拟设备损坏</td></tr><tr><td style=text-align:center>-r</td><td style=text-align:center>移除设备</td></tr><tr><td style=text-align:center>-Q</td><td style=text-align:center>查看摘要信息</td></tr><tr><td style=text-align:center>-D</td><td style=text-align:center>查看详细信息</td></tr><tr><td style=text-align:center>-S</td><td style=text-align:center>停止RAID磁盘阵列</td></tr></tbody></table><p>用命令创建 RAID 1，看到如下输出即为成功</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mdadm -Cv /dev/md1 -a yes -n <span style=color:#ae81ff>2</span> -l <span style=color:#ae81ff>1</span> /dev/sd<span style=color:#f92672>{</span>b,c<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>mdadm: chunk size defaults to 512K
</span></span><span style=display:flex><span>mdadm: Defaulting to version 1.2 metadata
</span></span><span style=display:flex><span>mdadm: array /dev/md1 started.
</span></span></code></pre></div><p>将创建好的RAID 1阵列格式化为ext4文件系统</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkfs.ext4 /dev/md1
</span></span></code></pre></div><p>查看RAID 1阵列的摘要信息，可以看到两块10GB的磁盘组成的RAID 1阵列容量约为10GB</p><pre tabindex=0><code>$ mdadm -Q /dev/md1
/dev/md1: 9.99GiB raid1 2 devices, 0 spares. Use mdadm --detail for more detail.
</code></pre><p>将RAID 1阵列临时挂载到<code>/mnt/raid1</code>目录下，测试文件读写</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /mnt/raid1/
</span></span><span style=display:flex><span>mount /dev/md1 /mnt/raid1
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;Hello, world!&#39;</span> &gt; /mnt/raid1/hello
</span></span><span style=display:flex><span>cat /mnt/raid1/hello
</span></span></code></pre></div><p>测试写文件速率，由于<code>dd</code>命令在计算时单位换算有误，因此我们自己计算出实际值为$8 \times 300000 \div 1024 \div 9.462=247.70MB/s$</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ time dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=</span>/dev/zero of<span style=color:#f92672>=</span>/mnt/raid1/test.bdf bs<span style=color:#f92672>=</span>8k count<span style=color:#f92672>=</span><span style=color:#ae81ff>300000</span>
</span></span><span style=display:flex><span>300000+0 records in
</span></span><span style=display:flex><span>300000+0 records out
</span></span><span style=display:flex><span><span style=color:#ae81ff>2457600000</span> bytes <span style=color:#f92672>(</span>2.5 GB, 2.3 GiB<span style=color:#f92672>)</span> copied, 9.46088 s, <span style=color:#ae81ff>260</span> MB/s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>real    0m9.462s
</span></span><span style=display:flex><span>user    0m0.159s
</span></span><span style=display:flex><span>sys     0m2.525s
</span></span></code></pre></div><p>测试读文件速率，实际值为$8 \times 1309568 \div 1024 \div 37.837=270.40MB/s$</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ time dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=</span>/dev/md1 of<span style=color:#f92672>=</span>/dev/null bs<span style=color:#f92672>=</span>8k
</span></span><span style=display:flex><span>1309568+0 records in
</span></span><span style=display:flex><span>1309568+0 records out
</span></span><span style=display:flex><span><span style=color:#ae81ff>10727981056</span> bytes <span style=color:#f92672>(</span><span style=color:#ae81ff>11</span> GB, <span style=color:#ae81ff>10</span> GiB<span style=color:#f92672>)</span> copied, 37.836 s, <span style=color:#ae81ff>284</span> MB/s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>real    0m37.837s
</span></span><span style=display:flex><span>user    0m0.456s
</span></span><span style=display:flex><span>sys     0m7.154s
</span></span></code></pre></div><p>模拟阵列中的一块磁盘损坏（注意：此方法仅适用于RAID 1、RAID 5、RAID 10，模拟RAID 0损坏的方法见下一节）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mdadm /dev/md1 -f /dev/sdb
</span></span><span style=display:flex><span>mdadm: set /dev/sdb faulty in /dev/md1
</span></span></code></pre></div><p>再次读取文件，发现文件完好无损</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ cat /mnt/raid1/hello
</span></span><span style=display:flex><span>Hello, world!
</span></span></code></pre></div><p>删除该阵列，释放磁盘空间</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>umount /mnt/raid1 
</span></span><span style=display:flex><span>mdadm -S /dev/md1
</span></span><span style=display:flex><span>mdadm --zero-superblock /dev/sd<span style=color:#f92672>{</span>b,c<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>同理可创建RAID 0、RAID 5、RAID 10等阵列</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mdadm -Cv /dev/md0 -a yes -n <span style=color:#ae81ff>2</span> -l <span style=color:#ae81ff>0</span> /dev/sd<span style=color:#f92672>{</span>b,c<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>mdadm -Cv /dev/md5 -a yes -n <span style=color:#ae81ff>5</span> -l <span style=color:#ae81ff>5</span> /dev/sd<span style=color:#f92672>{</span>b,c,d,e,f<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>mdadm -Cv /dev/md10 -a yes -n <span style=color:#ae81ff>4</span> -l <span style=color:#ae81ff>10</span> /dev/sd<span style=color:#f92672>{</span>b,c,d,e<span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=模拟raid-0阵列中磁盘损坏>模拟RAID 0阵列中磁盘损坏
<a class=anchor href=#%e6%a8%a1%e6%8b%9fraid-0%e9%98%b5%e5%88%97%e4%b8%ad%e7%a3%81%e7%9b%98%e6%8d%9f%e5%9d%8f>#</a></h3><p>在创建阵列之前，需要先给待使用的磁盘分区，以<code>/dev/sdb</code>为例</p><p>在<code>Command (m for help):</code>后面输入<code>n</code>，一路回车，默认按磁盘最大容量分区</p><p>最后在<code>Command (m for help):</code>后面输入<code>w</code>保存</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ fdisk /dev/sdb
</span></span><span style=display:flex><span>Command <span style=color:#f92672>(</span>m <span style=color:#66d9ef>for</span> help<span style=color:#f92672>)</span>:
</span></span></code></pre></div><p>新分区名称默认为<code>/dev/sdb1</code></p><p>同理，为<code>/dev/sdc</code>也创建一个分区<code>/dev/sdc1</code></p><p>在这两个分区上创建RAID 0阵列</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mdadm -Cv /dev/md0 -a yes -n <span style=color:#ae81ff>2</span> -l <span style=color:#ae81ff>0</span> /dev/sd<span style=color:#f92672>{</span>b1,c1<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>再使用fdisk删除分区：<code>fdisk /dev/sdb</code></p><p>在<code>Command (m for help):</code>后面输入<code>d</code>，然后在<code>Command (m for help):</code>后面输入<code>w</code>保存</p><p>更新分区表并重启</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>partprobe
</span></span><span style=display:flex><span>reboot
</span></span></code></pre></div><p>重启后发现RAID 0阵列已损坏</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mdadm -Q /dev/md0
</span></span><span style=display:flex><span>mdadm: cannot open /dev/md0: No such file or directory
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/alex-shpak/hugo-book/commit/fc4487700ab9e86a44f170856ce38360f833fccf title='Last modified by “h56983577” | October 29, 2022' target=_blank rel=noopener><img src=/doc/svg/calendar.svg class=book-icon alt=Calendar>
<span>October 29, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/alex-shpak/hugo-book/edit/main/exampleSite/content/ns-labs/table-of-contents/raid/index.md target=_blank rel=noopener><img src=/doc/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#lab01-raid阵列>Lab01 RAID阵列</a><ul><li><a href=#实验内容>实验内容</a></li><li><a href=#实验准备>实验准备</a><ul><li><a href=#windows下连接windows-10虚拟机>Windows下连接Windows 10虚拟机</a></li><li><a href=#macos下连接windows-10虚拟机>MacOS下连接Windows 10虚拟机</a></li><li><a href=#windows下连接ubuntu虚拟机>Windows下连接Ubuntu虚拟机</a></li><li><a href=#macos下连接ubuntu虚拟机>MacOS下连接Ubuntu虚拟机</a></li><li><a href=#校外连接ubuntu虚拟机>校外连接Ubuntu虚拟机</a></li><li><a href=#ubuntu虚拟机联网>Ubuntu虚拟机联网</a></li><li><a href=#重要提醒>重要提醒</a></li></ul></li><li><a href=#windows环境>Windows环境</a></li><li><a href=#ubuntu环境>Ubuntu环境</a><ul><li><a href=#使用lvm为根目录扩容>使用LVM为根目录扩容</a></li><li><a href=#raid阵列搭建>RAID阵列搭建</a></li><li><a href=#模拟raid-0阵列中磁盘损坏>模拟RAID 0阵列中磁盘损坏</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>